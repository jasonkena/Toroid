%was node [circle,draw=black,inner sep=0pt,minimum size={width("AAA")}] {\AlphAlph{\x}\AlphAlph{\y}};}}
% was [square,draw=black]
\providecommand{\toroid}[1]{
    \draw[shift={(-0.5,0.5)}] (1,-1) grid (#1+1,-#1-1);
        \foreach \x in {1,...,#1} {
            \foreach \y in {1,...,#1} {
                \node at (\x,-\y) {\AlphAlph{\y}\AlphAlph{\x}};}}
}
\providecommand{\superToroid}[4]{
    \IfBooleanTF#1{\providecommand{\shading}{white}}{\providecommand{\shading}{gray}}
    \draw[shift={(-0.5,0.5)}] (1,-1) grid (#2+1,-#2-1);
        \foreach \x in {1,...,#2} {
            \foreach \y in {1,...,#2} {
        \pgfmathtruncatemacro{\xpos}{(\x-1)*#2+(\y-1)}
        \pgfmathtruncatemacro{\ypos}{((#4-1)*#2+(#3-1))}
        \ifnum\xpos<\ypos
        \providecommand{\param}{white}
        \else
        \providecommand{\param}{\shading}
        \fi
\node[square,draw=black,fill=\param] at (\x,-\y)[align=center] {\AlphAlph{#3}\AlphAlph{#4}\\ \AlphAlph{\y}\AlphAlph{\x}};}}
}
\providecommand{\toroidWarp}[1]{
    \scalebox{0.8}{
    \begin{tikzpicture}
        \toroid{#1}
        \foreach \x in {1,...,#1} {
            \node at (\x,0) {\AlphAlph{#1}\AlphAlph{\x}};
            \node at (\x,-#1-1) {\AlphAlph{#1}\AlphAlph{\x}};
        }
        \foreach \y in {1,...,#1} {
            \node at (0,-\y) {\AlphAlph{\y}\AlphAlph{#1}};
            \node at (#1+1,-\y) {\AlphAlph{\y}\AlphAlph{1}};
        }
    \end{tikzpicture}
}}

\providecommand{\toroidAxes}[4]{
    \superToroid{#1}{#2}{#3}{#4}
        \foreach \x in {1,...,#2} {
            \node at (\x,0) {\AlphAlph{\x}};
        }
        \foreach \y in {1,...,#2} {
            \node at (0,-\y) {\AlphAlph{\y}};
        }
}

\NewDocumentCommand{\nestedToroid}{sm}{
    \scalebox{0.8}{
    \begin{tikzpicture}[scale=#2+1,square/.style={rectangle,inner sep=0pt,minimum size=1cm}]
        \begin{scope}[scale=1]
            \draw[shift={(-0.5,0.5)}] (1,-1) grid (#2+1,-#2-1);
            \foreach \x in {1,...,#2} {
                \node at (\x,-0.25) {\AlphAlph{\x}};
            }
            \foreach \y in {1,...,#2} {
                \node at (0.25,-\y) {\AlphAlph{\y}};
            }
            \foreach \xa in {1,...,#2} {
                \foreach \ya in {1,...,#2} {
                    \begin{scope}[shift={({\xa-0.5+1/(#2+1)^2},{-\ya+0.5-1/(#2+1)^2})},scale={1/(#2+1)}]
                        \toroidAxes{#1}{#2}{\xa}{\ya}
                    \end{scope}
                }
            }
        \end{scope}
    \end{tikzpicture}
    }
}
%a
\NewDocumentCommand{\twodcomparison}{sm}{
    \IfBooleanTF#1{\providecommand{\shading}{white}}{\providecommand{\shading}{gray}}
    \scalebox{0.8}{
\begin{tikzpicture}
    \begin{scope}[square/.style={rectangle,inner sep=0pt,minimum size=1cm}]
        %\draw[shift={(-0.5,0.5)}] (0,0) grid ({(#2^2)},{-(#2^2)});
        \foreach \x in {1,...,#2} {
            \foreach \xa in {1,...,#2} {
                \node at ({(\x-1)*#2+(\xa-1)},1) {\AlphAlph{\x}\AlphAlph{\xa}};
        }}
        \foreach \y in {1,...,#2} {
            \foreach \ya in {1,...,#2} {
                \node at (-1,{-((\y-1)*#2+(\ya-1))}) {\AlphAlph{\y}\AlphAlph{\ya}};
        }}
        \foreach \xa in {1,...,#2} {
            \foreach \ya in {1,...,#2} {
            \foreach \xb in {1,...,#2} {
                \foreach \yb in {1,...,#2} {
                \pgfmathtruncatemacro{\xpos}{(\xa-1)*#2+(\ya-1)}
                \pgfmathtruncatemacro{\ypos}{((\xb-1)*#2+(\yb-1))}
                %\pgfmathtruncatemacro\xpos{}
                %\pgfmathtruncatemacro\ypos{}
        \ifnum\xpos<\ypos
        \providecommand{\param}{white}
        \else
        \providecommand{\param}{\shading}
        \fi
\node[square,draw=black,fill=\param] at (\xpos,-\ypos)[align=center] {\AlphAlph{\xa}\AlphAlph{\ya}\\ \AlphAlph{\xb}\AlphAlph{\yb}};}}
            }
        }
    \end{scope}

\end{tikzpicture}
}}
